# 画面キャプチャ編集ツール - 拡張版

## ✨ v5.0 - PDF対応版（最新）

### 新機能
- ✅ **PDFファイル読み込み対応**
  - 複数ページのPDFを一括読み込み
  - 各ページを個別に編集可能
- ✅ **複数ページ管理**
  - ページタブUIで簡単切り替え
  - ページごとに独立した編集履歴
- ✅ **複数ページエクスポート**
  - **PNG形式**: 各ページを個別ファイルとして保存 (`filename-page-1.png`, `filename-page-2.png`...)
  - **JPEG形式**: 各ページを個別ファイルとして保存 (`filename-page-1.jpg`, `filename-page-2.jpg`...)
  - **PDF形式**: 全ページを1つのPDFファイルに統合
  - **SVG形式**: 各ページを個別ファイルとして保存 (`filename-page-1.svg`, `filename-page-2.svg`...)

### 使用ライブラリ
- **PDF.js** (v3.11.174) - PDFファイル読み込み
- **jsPDF** (v2.5.1) - PDFファイル出力

## 📁 ファイル構成

```
screen-capture-tool/
├── index.html                      # 本番ファイル（PDF対応版 v5.0）★
├── README.md                       # プロジェクトドキュメント
├── .gitignore                      # Git管理設定
├── archive/                        # 旧バージョン
│   ├── screen_capture_integrated.html
│   ├── screen_capture_v2.html
│   ├── screen_capture.py
│   ├── capture_tool_editable.html
│   ├── capture_tool_final.html
│   └── capture_tool_complete.html
├── docs/                           # ドキュメント・開発用ファイル
│   ├── index-pdf-support.html      # PDF対応版（開発用・本番と同一）
│   ├── MODULARIZATION_PLAN.md      # モジュール化実装計画
│   ├── codebase_analysis.md        # コードベース分析
│   ├── UIUX評価レポート.md         # UI/UX評価
│   ├── backups/                    # バックアップファイル
│   │   └── index.html.backup.pre-pdf  # PDF対応前バックアップ (v4.0)
│   ├── modularization/             # モジュール化関連ファイル
│   └── scripts/                    # ユーティリティスクリプト
└── バージョン管理/                 # 過去バージョン（V1-V14）
```

## 🚀 使い方

1. `index.html` をブラウザで開く
2. Win+Shift+S でスクリーンショット撮影
3. 「📋 クリップボード」ボタンで貼り付け
4. 描画ツールで注釈を追加
5. 「💾 保存」ボタンで保存

## ✨ 実装機能

### 1. 📷 読み込み機能
- ✅ クリップボードから貼り付け
- ✅ ファイル選択
- ✅ 画面キャプチャ（Screen Capture API）
- ✅ トリミング機能

### 2. 🎨 描画ツール
- ✅ 選択ツール（移動・編集）
- ✅ 矩形
- ✅ 円
- ✅ 線
- ✅ 矢印（線幅に連動した頭部サイズ）
- ✅ **ポリライン（連続線）** - 右クリックで終了、Shift+水平/垂直/45度制約
- ✅ **フリーハンド** - Shift+水平/垂直の直線描画
- ✅ テキスト（ダブルクリックで編集）
- ✅ 強調マーカー（透明度調整可能）

### 3. 🖱️ 編集機能
- ✅ **リサイズハンドル** - 四隅ドラッグでサイズ変更
- ✅ **ダブルクリック編集** - テキストを即座に編集
- ✅ ドラッグで移動
- ✅ 右クリックメニュー（編集・複製・削除）
- ✅ 取り消し（Ctrl+Z）

### 4. ⚙️ 設定
- ✅ 8色クイック選択
- ✅ 線の太さ調整
- ✅ 文字サイズ調整
- ✅ **透明度調整（10-80%）** - 強調マーカー用

### 5. 💾 保存機能
- ✅ **ヘッダーにファイル名入力**
- ✅ **ヘッダーに保存先選択**
- ✅ PNG形式で保存
- ✅ Ctrl+S で即座に保存

### 6. 🎯 キャンバス操作性
- ✅ **マウス中ボタンドラッグでパン移動**
- ✅ **タッチスワイプでパン移動**（スマホ・タブレット対応）
- ✅ **ピンチズームで拡大縮小**（タッチデバイス対応）
- ✅ **Ctrl+ホイールでズーム**（PC対応）
- ✅ **十分な余白で全エリア表示**（100pxパディング）

### 7. 🎯 その他
- ✅ ズーム機能（10%-500%）
- ✅ ショートカットキー対応
- ✅ トースト通知

## ⌨️ ショートカットキー

| キー | 機能 |
|------|------|
| `Ctrl+V` | クリップボードから貼り付け |
| `Ctrl+S` | 保存 |
| `Ctrl+Z` | 取り消し |
| `Ctrl+D` | 選択図形を複製 |
| `Delete` | 選択図形を削除 |
| `Esc` | ポリライン描画をキャンセル |
| `Shift` | フリーハンド：水平/垂直直線、ポリライン：45度制約 |
| `マウス中ボタン+ドラッグ` | キャンバスをパン移動 |
| `Ctrl+ホイール` | ズームイン/アウト |

## 📱 タッチ操作

| 操作 | 機能 |
|------|------|
| `1本指スワイプ` | キャンバスをパン移動 |
| `2本指ピンチ` | ズームイン/アウト |

## 📐 ポリラインの使い方

1. 「連続線」ツールを選択
2. キャンバス上でクリック連続
3. 右クリックまたはEscキーで終了

## ✂️ トリミングの使い方

1. 画像を読み込む
2. 「✂️ トリミング」ボタンをクリック
3. マウスドラッグでトリミング範囲を選択
4. 「トリミング実行」ボタンをクリック

## 🌐 対応ブラウザ

- Google Chrome（推奨）
- Microsoft Edge
- Firefox（一部機能制限あり）

## 📝 注意事項

- 画面キャプチャ機能は最新ブラウザのみ対応
- フォルダ選択機能はChrome/Edgeのみ対応
- クリップボードアクセスには権限が必要

## 🔄 更新履歴

### v5.2 (2025-10-20) - フリーハンド直交モード ✏️
- ✏️ **Shift+フリーハンドで直線描画**
  - Shiftキーを押しながらフリーハンドツールを使用すると水平/垂直の直線が描ける
  - 直前の点からの移動量を比較し、より大きい方向（水平または垂直）に自動制約
  - 定規を使ったような正確な直線が簡単に描画可能
- 📝 **ドキュメント更新**
  - ショートカットキー一覧にShiftキーの機能を追加
  - 描画ツール一覧を更新

### v5.1 (2025-10-20) - キャンバス操作性改善 🖱️📱
- 🖱️ **マウス中ボタンパン機能**
  - マウスホイールボタンを押しながらドラッグでキャンバスを自由に移動
  - カーソルが`grab`→`grabbing`に変化して直感的
- 📱 **タッチデバイス完全対応**
  - 1本指スワイプでパン移動
  - 2本指ピンチでズームイン/アウト
  - スマホ・タブレットでの操作性が大幅向上
- ⌨️ **Ctrl+ホイールズーム**
  - PCでのズーム操作を追加
  - ズーム範囲を10%-500%に拡大
- 🎨 **キャンバス表示改善**
  - padding を100pxに拡大して十分な余白を確保
  - ズーム時に全エリアが表示可能
  - 背景色を#f0f0f0に変更して視認性向上

### v5.0 (2025-10-20) - PDF対応版 📄✨
- 📄 **PDFファイル読み込み機能**
  - PDF.js (v3.11.174) による複数ページPDF対応
  - 各ページを自動的に画像化してキャンバスに配置
- 📑 **複数ページ管理システム**
  - ページタブUIで直感的なページ切り替え
  - ページごとに独立した編集状態を保持
  - ページ削除機能（最後の1ページは削除不可）
- 💾 **全エクスポート形式の複数ページ対応**
  - PNG: 各ページを個別ファイルとして保存
  - JPEG: 各ページを個別ファイルとして保存（画質選択可能）
  - PDF: 全ページを1つのPDFファイルに統合
  - SVG: 各ページを個別ファイルとして保存
- 🎨 **UIデザイン改善**
  - ページタブのビジュアルデザイン（コーポレートカラー #005BAB 使用）
  - 複数ページ時のみタブを表示
- 🔄 **下位互換性維持**
  - 単一画像の編集機能は従来通り動作
  - 既存の全機能を保持

### v4.0 (2025-10-18) - モジュール化版 ✨
- 🏗️ **コード構造の大幅改善**
  - IIFE（即時実行関数式）によるスコープ分離
  - 47個のグローバル変数をAppStateオブジェクトに集約
  - 40個の関数をグローバルAPI公開
- 🐛 **バグ修正**
  - モザイク/ぼかしのマイナス方向ドラッグ時の座標ずれを修正
- 📁 **ディレクトリ整理**
  - docsディレクトリ作成
  - バックアップファイルの整理
  - モジュール化関連ファイルの整理
- 📖 **ドキュメント充実**
  - モジュール化実装計画書作成
  - Git管理による変更履歴追跡

### v3.0 (2025-10-07)
- ✨ リサイズハンドル実装
- ✨ テキストダブルクリック編集
- ✨ 矢印の太さ修正（線幅連動）
- ✨ ポリライン（連続線）機能
- ✨ トリミング機能
- ✨ 透明度範囲修正（強調マーカー用）
- ✨ 画面キャプチャ機能
- ✨ UIレイアウト改善（保存設定をヘッダーに移動）

### v2.0
- 基本的な描画機能
- 選択・移動・編集機能
- 保存機能

### v1.0
- 初版リリース

## 🚧 今後の展望

現在のv4.0でモジュール化の第一段階（AppState実装）が完了しました。
今後の改善案については `docs/MODULARIZATION_PLAN.md` を参照してください。

### 推奨される次のステップ
1. **Vite導入** - 開発環境の近代化
2. **TypeScript化** - 型安全性の向上
3. **Web Worker活用** - モザイク/ぼかし処理の並列化
4. **テスト導入** - Vitestによるユニットテスト

詳細は [Gemini CLIによるコードレビュー結果](docs/MODULARIZATION_PLAN.md#-gemini-cliによるコードレビュー結果) を参照してください。
